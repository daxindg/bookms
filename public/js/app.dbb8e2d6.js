(function(t){function e(e){for(var o,a,s=e[0],i=e[1],l=e[2],d=0,b=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(c,a)&&c[a]&&b.push(c[a][0]),c[a]=0;for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);u&&u(e);while(b.length)b.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],o=!0,s=1;s<n.length;s++){var i=n[s];0!==c[i]&&(o=!1)}o&&(r.splice(e--,1),t=a(a.s=n[0]))}return t}var o={},c={app:0},r=[];function a(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=o,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,function(e){return t[e]}.bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],i=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=i;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0492":function(t,e,n){"use strict";n("9202")},"0520":function(t,e,n){"use strict";n("c932")},"127d":function(t,e,n){},1870:function(t,e,n){},"215e":function(t,e,n){"use strict";n("6a92")},"28af":function(t,e,n){},"2f4c":function(t,e,n){},"2f88":function(t,e,n){},"35bd":function(t,e,n){"use strict";n("8d46")},"37fb":function(t,e,n){},"39e2":function(t,e,n){"use strict";n("71a2")},"417f":function(t,e,n){"use strict";n("127d")},"41eb":function(t,e,n){},"517f":function(t,e,n){"use strict";n("28af")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("7a23"),c=(n("ac1f"),n("841c"),n("498a"),{key:0,class:"fallback"}),r={key:1,class:"container"};function a(t,e,n,a,s,i){var l=Object(o["m"])("top-bar"),u=Object(o["m"])("author-tool"),d=Object(o["m"])("tag-tool"),b=Object(o["m"])("search-bar"),h=Object(o["m"])("pagination"),f=Object(o["m"])("book-item");return Object(o["h"])(),Object(o["c"])(o["a"],null,[Object(o["g"])(l,{user:s.user,onLogin:e[1]||(e[1]=function(t){return s.user=t}),onRegister:e[2]||(e[2]=function(t){return s.user=t}),onLogout:e[3]||(e[3]=function(t){return s.user={class:"guest"}})},null,8,["user"]),Object(o["g"])(b,{"onSubmit-search":e[5]||(e[5]=function(t){return i.search(t)})},{default:Object(o["r"])((function(){return[Object(o["g"])(u,{large:!0,"toggle-search":!0,"toggle-count":!0,"toggle-add":"guest"!==s.user.class&&"user"!==s.user.class,"toggle-delete":"guest"!==s.user.class&&"user"!==s.user.class,"onAuthors-changed":e[4]||(e[4]=function(t){return s.authors=t})},null,8,["toggle-add","toggle-delete"]),Object(o["g"])(d,{large:!0,"toggle-search":!0,"toggle-count":!0,"toggle-add":"guest"!==s.user.class&&"user"!==s.user.class,"toggle-delete":"guest"!==s.user.class&&"user"!==s.user.class},null,8,["toggle-add","toggle-delete"])]})),_:1}),Object(o["g"])(h,{total:s.totalPages,"onPage-updated":e[6]||(e[6]=function(t){return s.currentPage=t})},null,8,["total"]),s.fallback.trim().length>0?(Object(o["h"])(),Object(o["c"])("div",c,[Object(o["g"])("h1",null,Object(o["n"])(s.fallback),1)])):(Object(o["h"])(),Object(o["c"])("div",r,[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(s.books,(function(t,e){return Object(o["h"])(),Object(o["c"])(f,{key:e,bookdata:t,userclass:s.user.class},null,8,["bookdata","userclass"])})),128))]))],64)}n("4de4"),n("d81d"),n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d");var s=Object(o["u"])("data-v-ecd76d32");Object(o["j"])("data-v-ecd76d32");var i=Object(o["g"])("p",null,"tags",-1),l={class:"modal"},u={class:"header"},d={class:"left"},b={class:"tag-box"},h={class:"author-box"},f={class:"right"},g=Object(o["g"])("h5",null,"简介",-1),m={id:"book_intro"},j={class:"book-props"},O={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},v=Object(o["g"])("path",{d:"M18.363 8.464l1.433 1.431-12.67 12.669-7.125 1.436 1.439-7.127 12.665-12.668 1.431 1.431-12.255 12.224-.726 3.584 3.584-.723 12.224-12.257zm-.056-8.464l-2.815 2.817 5.691 5.692 2.817-2.821-5.693-5.688zm-12.318 18.718l11.313-11.316-.705-.707-11.313 11.314.705.709z"},null,-1),p={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},w=Object(o["g"])("path",{d:"M20.285 2l-11.285 11.567-5.286-5.011-3.714 3.716 9 8.728 15-15.285z"},null,-1),k={class:"footer"};Object(o["i"])();var _=s((function(t,e,n,c,r,a){var _=Object(o["m"])("card"),y=Object(o["m"])("tag-tool"),T=Object(o["m"])("author-tool"),C=Object(o["m"])("material-button");return Object(o["h"])(),Object(o["c"])(o["a"],null,[Object(o["g"])(_,{onClick:e[1]||(e[1]=function(t){return r.show_modal=!0}),"data-image":r.cover.src},{header:s((function(){return[Object(o["g"])("h1",null,Object(o["n"])(r.book_props.title.val),1)]})),content:s((function(){return[i]})),_:1},8,["data-image"]),Object(o["s"])(Object(o["g"])("div",{class:["modal_mask",{shown:r.show_modal}],onClick:e[4]||(e[4]=function(t){return r.show_modal=!1})},[Object(o["g"])("div",l,[Object(o["g"])("div",{class:"book",onClick:e[3]||(e[3]=Object(o["t"])((function(){}),["stop"]))},[Object(o["g"])("span",{class:"btn_close",onClick:e[2]||(e[2]=function(t){return r.show_modal=!1})},"×"),Object(o["g"])("div",u,[Object(o["g"])("div",d,[Object(o["g"])("img",{src:r.cover.src,alt:r.cover.alt},null,8,["src","alt"]),Object(o["g"])("div",b,[Object(o["g"])(y,{"toggle-add":"user"!==n.userclass&&"guest"!==n.userclass,bid:n.bookdata.bid,"toggle-delete":"guest"!==n.userclass&&"user"!==n.userclass},null,8,["toggle-add","bid","toggle-delete"])]),Object(o["g"])("div",h,[Object(o["g"])(T,{"toggle-add":"user"!==n.userclass&&"guest"!==n.userclass,bid:n.bookdata.bid,"toggle-delete":"guest"!==n.userclass&&"user"!==n.userclass},null,8,["toggle-add","bid","toggle-delete"])])]),Object(o["g"])("div",f,[g,Object(o["g"])("div",m,Object(o["n"])(r.book_intro),1)])]),Object(o["g"])("div",j,[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(r.book_props,(function(t,e,c){return Object(o["h"])(),Object(o["c"])("div",{class:"input_group",key:c},[Object(o["g"])("label",{for:e},Object(o["n"])(t.label),9,["for"]),Object(o["s"])(Object(o["g"])("input",{type:t.type,"onUpdate:modelValue":function(e){return t.val=e},name:e,disabled:t.disabled},null,8,["type","onUpdate:modelValue","name","disabled"]),[[o["o"],t.val]]),"guest"!==n.userclass&&"user"!==n.userclass?(Object(o["h"])(),Object(o["c"])("button",{key:0,class:["btn_edit",{active:!t.disabled}],onClick:function(n){return a.onBtnEditClicked(t,e)}},[t.disabled?(Object(o["h"])(),Object(o["c"])("svg",O,[v])):(Object(o["h"])(),Object(o["c"])("svg",p,[w]))],10,["onClick"])):Object(o["d"])("",!0)])})),128))]),Object(o["g"])("div",k,[a.can_delete?(Object(o["h"])(),Object(o["c"])(C,{key:0,class:"btn_remove",content:"删除",onClick:a.deleteBook},null,8,["onClick"])):Object(o["d"])("",!0),Object(o["g"])(C,{class:"btn_borrow",disabled:!a.can_borrow,content:"借阅",onClick:a.borrowBook},null,8,["disabled","onClick"])])])])],2),[[o["q"],r.show_modal]])],64)})),y=Object(o["u"])("data-v-a1d034b4");Object(o["j"])("data-v-a1d034b4");var T={class:"card-info"};Object(o["i"])();var C=y((function(t,e,n,c,r,a){return Object(o["h"])(),Object(o["c"])("div",{class:"card-wrap",onMousemove:e[1]||(e[1]=function(){return a.handleMouseMove.apply(a,arguments)}),onMouseenter:e[2]||(e[2]=function(){return a.handleMouseEnter.apply(a,arguments)}),onMouseleave:e[3]||(e[3]=function(){return a.handleMouseLeave.apply(a,arguments)}),ref:"card"},[Object(o["g"])("div",{class:"card",style:a.cardStyle},[Object(o["g"])("img",{src:r.cardbg,class:"card-bg",style:[a.cardBgTransform]},null,12,["src"]),Object(o["g"])("div",T,[Object(o["l"])(t.$slots,"header"),Object(o["l"])(t.$slots,"content")])],4)],544)})),x=(n("99af"),{name:"Card",mounted:function(){this.width=this.$refs.card.offsetWidth,this.height=this.$refs.card.offsetHeight},props:{dataImage:String},data:function(){return{width:0,height:0,mouseX:0,mouseY:0,mouseLeaveDelay:null,cardbg:this.dataImage}},computed:{mousePX:function(){return this.mouseX/this.width},mousePY:function(){return this.mouseY/this.height},cardStyle:function(){var t=30*this.mousePX,e=-30*this.mousePY;return{transform:"rotateY(".concat(t,"deg) rotateX(").concat(e,"deg)")}},cardBgTransform:function(){var t=-40*this.mousePX,e=-40*this.mousePY;return{transform:"translateX(".concat(t,"px) translateY(").concat(e,"px)")}}},methods:{handleMouseMove:function(t){this.mouseX=t.pageX-this.$refs.card.offsetLeft-this.width/2,this.mouseY=t.pageY-this.$refs.card.offsetTop-this.height/2},handleMouseEnter:function(){clearTimeout(this.mouseLeaveDelay)},handleMouseLeave:function(){this.mouseX=0,this.mouseY=0}}});n("35bd");x.render=C,x.__scopeId="data-v-a1d034b4";var S=x,B=Object(o["u"])("data-v-b27755c6");Object(o["j"])("data-v-b27755c6");var P={key:1,class:"material-button"};Object(o["i"])();var I=B((function(t,e,n,c,r,a){return n.isInput?(Object(o["h"])(),Object(o["c"])("input",{key:0,class:"material-button",type:"submit",value:n.content},null,8,["value"])):(Object(o["h"])(),Object(o["c"])("button",P,Object(o["n"])(n.content),1))})),$={name:"MaterialButton",props:{isInput:Boolean,content:String}};n("0492");$.render=I,$.__scopeId="data-v-b27755c6";var A=$,M=(n("b0c0"),n("b64b"),Object(o["u"])("data-v-4922315e"));Object(o["j"])("data-v-4922315e");var N={class:"header"},D={key:0,class:"title"},U=Object(o["g"])("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"#00b0ff"},[Object(o["g"])("path",{d:"M24 10h-10v-10h-4v10h-10v4h10v10h4v-10h10z"})],-1),E={key:0,class:"spliter"},F={class:"content"},L={key:0,class:"bcount"},z=Object(o["g"])("div",{class:"footer"},null,-1),R={class:"dropdown-container"},G={key:0,class:"dropdown"},V={key:0,class:"check status"},J={key:1,class:"cross status"},X={key:2};Object(o["i"])();var Y=M((function(t,e,n,c,r,a){var s=Object(o["m"])("search-bar"),i=Object(o["m"])("material-button"),l=Object(o["m"])("modal");return Object(o["h"])(),Object(o["c"])(o["a"],null,[Object(o["g"])("div",{class:["container",{small:!n.large}]},[Object(o["g"])("div",N,[!0!==n.hideTitle?(Object(o["h"])(),Object(o["c"])("span",D,"标签")):Object(o["d"])("",!0),n.toggleSearch?(Object(o["h"])(),Object(o["c"])(s,{key:1,class:"searchbar","search-text":r.searchText,"onUpdate:search-text":e[1]||(e[1]=function(t){return r.searchText=t})},null,8,["search-text"])):Object(o["d"])("",!0),n.toggleAdd?(Object(o["h"])(),Object(o["c"])("button",{key:2,type:"button",class:"add-new",onClick:e[2]||(e[2]=function(t){return r.show_modal_add=!0})},[U])):Object(o["d"])("",!0)]),n.large?(Object(o["h"])(),Object(o["c"])("div",E)):Object(o["d"])("",!0),Object(o["g"])("div",F,[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(void 0===n.bid?a.allTags:r.tags,(function(t,e){return Object(o["h"])(),Object(o["c"])("div",{class:["tag",{active:t.active&&void 0===n.bid}],key:e,onClick:function(e){return a.onClickTag(t)}},[Object(o["f"])(Object(o["n"])(t.name)+" ",1),n.toggleCount?(Object(o["h"])(),Object(o["c"])("span",L,Object(o["n"])(t.bcount),1)):Object(o["d"])("",!0),n.toggleDelete?(Object(o["h"])(),Object(o["c"])("span",{key:1,class:"close",onClick:Object(o["t"])((function(e){return a.removeTag(t.tid)}),["stop"])},"×",8,["onClick"])):Object(o["d"])("",!0)],10,["onClick"])})),128))]),z],2),n.toggleAdd?(Object(o["h"])(),Object(o["c"])(l,{key:0,class:"modal-add small","show-modal":r.show_modal_add,onClose:e[6]||(e[6]=function(t){return r.show_modal_add=!1}),title:"新建标签"},{footer:M((function(){return[Object(o["g"])(i,{type:"submit",form:"new-tag-form",content:r.submiting?"submiting":"submit"},null,8,["content"])]})),default:M((function(){return[Object(o["g"])("form",{class:"form",id:"new-tag-form",onSubmit:e[5]||(e[5]=Object(o["t"])((function(){return a.submitNewTag.apply(a,arguments)}),["stop","prevent"]))},[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(Object.keys(r.new_tag_form).sort(),(function(t){return Object(o["h"])(),Object(o["c"])("div",{class:["form-control",{success:!0===r.new_tag_form[t].valid,error:!1===r.new_tag_form[t].valid}],key:r.new_tag_form[t].order},[Object(o["g"])("label",{for:t},Object(o["n"])(r.new_tag_form[t].label_name),9,["for"]),Object(o["s"])(Object(o["g"])("input",{type:r.new_tag_form[t].type,name:t,"onUpdate:modelValue":function(e){return r.new_tag_form[t].value=e},onFocus:e[3]||(e[3]=function(t){return r.focus=!0}),onFocusout:e[4]||(e[4]=function(){return a.inputFocusout.apply(a,arguments)}),autocomplete:"off"},null,40,["type","name","onUpdate:modelValue"]),[[o["o"],r.new_tag_form[t].value]]),Object(o["g"])("div",R,[void 0!==n.bid&&!0===r.focus?(Object(o["h"])(),Object(o["c"])("div",G,[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(a.dropdownItems,(function(e,n){return Object(o["h"])(),Object(o["c"])("div",{class:"dropdown-item",key:n,onClick:function(){r.focus=!1,r.new_tag_form[t].value=e.name}},Object(o["n"])(e.name),9,["onClick"])})),128))])):Object(o["d"])("",!0)]),!0===r.new_tag_form[t].valid?(Object(o["h"])(),Object(o["c"])("span",V,"✔️")):Object(o["d"])("",!0),!1===r.new_tag_form[t].valid?(Object(o["h"])(),Object(o["c"])("span",J,"❌")):Object(o["d"])("",!0),!1===r.new_tag_form[t].valid?(Object(o["h"])(),Object(o["c"])("small",X,Object(o["n"])(r.new_tag_form[t].err),1)):Object(o["d"])("",!0)],2)})),128))],32)]})),_:1},8,["show-modal"])):Object(o["d"])("",!0)],64)})),q=(n("a9e3"),n("4d63"),n("25f0"),n("2909")),K=Object(o["u"])("data-v-5cffb546");Object(o["j"])("data-v-5cffb546");var H=Object(o["g"])("svg",{focusable:"false",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"svg-search",width:"20",fill:"orangered"},[Object(o["g"])("path",{d:"M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})],-1);Object(o["i"])();var Z=K((function(t,e,n,c,r,a){return Object(o["h"])(),Object(o["c"])("form",{class:["search-box",{expand:a.expand}],onSubmit:e[4]||(e[4]=Object(o["t"])((function(){}),["prevent"]))},[Object(o["g"])("input",{type:"text",name:"",class:"search-txt",placeholder:"Type to search",value:n.searchText,onInput:e[1]||(e[1]=function(e){return t.$emit("update:search-text",e.target.value)}),ref:"search",onFocus:e[2]||(e[2]=function(e){return t.$emit("focus")})},null,40,["value"]),Object(o["l"])(t.$slots,"default"),Object(o["g"])("span",{class:"search-btn",href:"#",onClick:e[3]||(e[3]=function(e){return t.$emit("submit")})},[H])],34)})),W={name:"CollapseSearchBox",props:{searchText:String},data:function(){return{}},computed:{expand:function(){return this.searchText&&this.searchText.length>0}},watch:{searchText:function(){this.$refs.search.focus()}}};n("af27");W.render=Z,W.__scopeId="data-v-5cffb546";var Q=W,tt=Object(o["u"])("data-v-495a16dc");Object(o["j"])("data-v-495a16dc");var et={class:"modal"},nt={class:"header"},ot={class:"title"},ct={class:"btn-close-wrapper"},rt={class:"content"},at={class:"footer"};Object(o["i"])();var st=tt((function(t,e,n,c,r,a){return a.show_modal?(Object(o["h"])(),Object(o["c"])("div",{key:0,class:"modal-mask",onClick:e[3]||(e[3]=function(e){return t.$emit("close")})},[Object(o["g"])("div",et,[Object(o["g"])("div",{class:"modal-body",onClick:e[2]||(e[2]=Object(o["t"])((function(){}),["stop"]))},[Object(o["g"])("div",nt,[Object(o["g"])("h5",ot,Object(o["n"])(n.title),1),Object(o["l"])(t.$slots,"header"),Object(o["g"])("div",ct,[Object(o["g"])("span",{class:"btn-close",onClick:e[1]||(e[1]=function(e){return t.$emit("close")})}," × ")])]),Object(o["g"])("div",rt,[Object(o["l"])(t.$slots,"default")]),Object(o["g"])("div",at,[Object(o["l"])(t.$slots,"footer")])])])])):Object(o["d"])("",!0)})),it={name:"Modal",props:{showModal:Boolean,title:String},computed:{show_modal:function(){return this.showModal}}};n("e2a2");it.render=st,it.__scopeId="data-v-495a16dc";var lt=it,ut={name:"TagTool",components:{SearchBar:Q,Modal:lt,MaterialButton:A},props:{large:Boolean,toggleSearch:Boolean,toggleAdd:Boolean,toggleCount:Boolean,toggleDelete:Boolean,hideTitle:Boolean,bid:Number},data:function(){return{tags:[],new_tag_form:{name:{order:1,label_name:"标签名",type:"text",focus:!1,value:"",err:""}},show_modal_add:!1,searchText:"",submiting:!1,focus:!1}},watch:{searchText:function(t){if(t=t.trim(),t){var e=RegExp(t),n=this.$root.tags.filter((function(t){return t.active})),o=this.$root.tags.filter((function(t){return!t.active})),c=o.filter((function(t){return e.test(t.name)})),r=o.filter((function(t){return!e.test(t.name)}));this.$root.tags=[].concat(Object(q["a"])(n),Object(q["a"])(c),Object(q["a"])(r))}}},computed:{dropdownItems:function(){if(!(this.new_tag_form.name.value.trim().length<=0)){try{var t=new RegExp(this.new_tag_form.name.value.trim())}catch(n){return}var e=this.allTags.filter((function(e){return t.test(e.name)}));return console.log(e),e}},allTags:function(){return this.$root.tags}},methods:{onClickTag:function(t){void 0===this.bid&&(t.active=!t.active,this.$root.tags=[].concat(Object(q["a"])(this.$root.tags.filter((function(t){return t.active}))),Object(q["a"])(this.$root.tags.filter((function(t){return!t.active})))))},inputFocusout:function(){var t=this;setTimeout((function(){return t.focus=!1}),200)},fetchTags:function(){var t=this;void 0!==this.bid?fetch("/api/tag/list/".concat(this.bid||""),{method:"GET"}).then((function(t){return t.json()})).then((function(e){e.ok&&(t.tags=e.data)})).catch((function(t){return console.log(t)})):this.$root.tags=this.$root.tags.map((function(t){return t.active=!1,t}))},submitNewTag:function(t){var e=this;if(void 0===this.bid){var n=new FormData(t.target),o=this.new_tag_form.name;o.value=o.value.trim(),o.value.length<=0?(o.valid=!1,o.err="标签名不可为空"):this.$root.tags.filter((function(t){return t.name===o.value})).length>0?(o.valid=!1,o.err="标签已存在"):(o.valid=!0,o.err=""),o.valid&&(this.submiting=!0,fetch("/api/tag/new",{method:"POST",body:n}).then((function(t){return t.json()})).then((function(t){t.ok?e.$root.tags.push(t.data):(o.valid=!1,o.err=t.msg),e.submiting=!1})).catch((function(t){console.log(t),o.valid=!1,o.err="网络错误",e.submiting=!1})))}else{var c=this.new_tag_form.name;if(c.value=c.value.trim(),c.value.length<=0)c.valid=!1,c.err="标签名不可为空";else if(this.tags.filter((function(t){return t.name===c.value})).length>0)c.valid=!1,c.err="标签已存在";else if(this.$root.tags.filter((function(t){return t.name===c.value})).length<=0)c.valid=!1,c.err="标签不存在";else{var r=this.$root.tags.filter((function(t){return t.name===c.value}))[0].tid;this.submiting=!0,fetch("/api/tag/add/".concat(r,"/").concat(this.bid),{method:"POST"}).then((function(t){return t.json()})).then((function(t){if(t.ok){c.valid=!0;var n=e.$root.tags.filter((function(t){return t.name===c.value}))[0];n.bcount++,e.tags.push(n),setTimeout((function(){e.show_modal_add=!1,delete c.valid,c.err="",c.value=""}),500)}else c.valid=!1,c.err=t.msg;e.submiting=!1})).catch((function(t){console.log(t),c.valid=!1,c.err="网络错误",e.submiting=!1}))}}},removeTag:function(t){var e=this;confirm("删除标签?")&&fetch("/api/tag/del/".concat(t,"/").concat(this.bid||""),{method:"POST"}).then((function(t){return t.json()})).then((function(t){t.ok?void 0!==e.bid?(e.tags=e.tags.filter((function(e){return e.tid!==t.data.tid})),e.$root.tags.filter((function(e){return e.tid===t.data.tid}))[0].bcount--):e.$root.tags=e.$root.tags.filter((function(e){return e.tid!==t.data.tid})):alert(t.msg)})).catch((function(t){return console.log(t)}))}},created:function(){this.fetchTags()},unmounted:function(){void 0===this.bid&&(this.$root.tags=this.$root.tags.map((function(t){return t.active=!1,t})))}};n("8dcf");ut.render=Y,ut.__scopeId="data-v-4922315e";var dt=ut,bt=Object(o["u"])("data-v-6b6052fa");Object(o["j"])("data-v-6b6052fa");var ht={class:"header"},ft={key:0,class:"title"},gt={key:0,class:"dropdown-container collapse"},mt={class:"dropdown"},jt=Object(o["g"])("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"#00b0ff"},[Object(o["g"])("path",{d:"M24 10h-10v-10h-4v10h-10v4h10v10h4v-10h10z"})],-1),Ot={key:0,class:"spliter"},vt={class:"content"},pt={key:0,class:"bcount"},wt=Object(o["g"])("div",{class:"footer"},null,-1),kt={key:0,class:"dropdown-container"},_t={class:"dropdown"},yt={key:1,class:"check status"},Tt={key:2,class:"cross status"},Ct={key:3};Object(o["i"])();var xt=bt((function(t,e,n,c,r,a){var s=Object(o["m"])("search-bar"),i=Object(o["m"])("material-button"),l=Object(o["m"])("modal");return Object(o["h"])(),Object(o["c"])(o["a"],null,[Object(o["g"])("div",{class:["container",{small:!n.large}]},[Object(o["g"])("div",ht,[!0!==n.hideTitle?(Object(o["h"])(),Object(o["c"])("span",ft,"作者")):Object(o["d"])("",!0),n.toggleSearch?(Object(o["h"])(),Object(o["c"])(s,{key:1,class:"searchbar",onFocus:e[1]||(e[1]=function(t){return r.searchfocus=!0}),onFocusout:a.inputFocusout,"search-text":r.inputSearchAuthorName,"onUpdate:search-text":e[2]||(e[2]=function(t){return r.inputSearchAuthorName=t}),onSubmit:a.chooseAuthor},{default:bt((function(){return[!0===r.searchfocus?(Object(o["h"])(),Object(o["c"])("div",gt,[Object(o["g"])("div",mt,[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(r.dropdownItems,(function(t,e){return Object(o["h"])(),Object(o["c"])("div",{class:"dropdown-item",key:e,onClick:function(){r.searchfocus=!1,r.inputSearchAuthorName=t.name}},Object(o["n"])(t.name),9,["onClick"])})),128))])])):Object(o["d"])("",!0)]})),_:1},8,["onFocusout","search-text","onSubmit"])):Object(o["d"])("",!0),n.toggleAdd?(Object(o["h"])(),Object(o["c"])("button",{key:2,type:"button",class:"add-new",onClick:e[3]||(e[3]=function(t){return r.show_modal_add=!0})},[jt])):Object(o["d"])("",!0)]),n.large?(Object(o["h"])(),Object(o["c"])("div",Ot)):Object(o["d"])("",!0),Object(o["g"])("div",vt,[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(r.authors,(function(t,e){return Object(o["h"])(),Object(o["c"])("div",{class:"item",key:e,onClick:function(e){return a.unchooseAuthor(t.aid)}},[Object(o["f"])(Object(o["n"])(t.name)+" ",1),n.toggleCount?(Object(o["h"])(),Object(o["c"])("span",pt,Object(o["n"])(t.bcount),1)):Object(o["d"])("",!0),n.toggleDelete?(Object(o["h"])(),Object(o["c"])("span",{key:1,class:"close",onClick:Object(o["t"])((function(e){return a.removeAuthor(t.aid)}),["stop"])},"×",8,["onClick"])):Object(o["d"])("",!0)],8,["onClick"])})),128))]),wt],2),n.toggleAdd?(Object(o["h"])(),Object(o["c"])(l,{key:0,class:"modal-add small","show-modal":r.show_modal_add,onClose:e[7]||(e[7]=function(t){return r.show_modal_add=!1}),title:"新建作者"},{footer:bt((function(){return[Object(o["g"])(i,{type:"submit",form:"new-author-form",content:r.submiting?"submiting":"submit"},null,8,["content"])]})),default:bt((function(){return[Object(o["g"])("form",{class:"form",id:"new-author-form",onSubmit:e[6]||(e[6]=Object(o["t"])((function(){return a.submitNewAuthor.apply(a,arguments)}),["prevent"]))},[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(Object.keys(r.new_author_form).sort(),(function(t){return Object(o["h"])(),Object(o["c"])("div",{class:["form-control",{success:!0===r.new_author_form[t].valid,error:!1===r.new_author_form[t].valid}],key:r.new_author_form[t].order},[Object(o["g"])("label",{for:t},Object(o["n"])(r.new_author_form[t].label_name),9,["for"]),Object(o["s"])(Object(o["g"])("input",{type:r.new_author_form[t].type,name:t,"onUpdate:modelValue":function(e){return r.new_author_form[t].value=e},onFocus:e[4]||(e[4]=function(t){return r.inputfocus=!0}),onFocusout:e[5]||(e[5]=function(){return a.inputFocusout.apply(a,arguments)}),autocomplete:"off"},null,40,["type","name","onUpdate:modelValue"]),[[o["o"],r.new_author_form[t].value]]),!0===r.inputfocus?(Object(o["h"])(),Object(o["c"])("div",kt,[Object(o["g"])("div",_t,[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(r.dropdownItems,(function(e,n){return Object(o["h"])(),Object(o["c"])("div",{class:"dropdown-item",key:n,onClick:function(){r.inputfocus=!1,r.new_author_form[t].value=e.name}},Object(o["n"])(e.name),9,["onClick"])})),128))])])):Object(o["d"])("",!0),!0===r.new_author_form[t].valid?(Object(o["h"])(),Object(o["c"])("span",yt,"✔️")):Object(o["d"])("",!0),!1===r.new_author_form[t].valid?(Object(o["h"])(),Object(o["c"])("span",Tt,"❌")):Object(o["d"])("",!0),!1===r.new_author_form[t].valid?(Object(o["h"])(),Object(o["c"])("small",Ct,Object(o["n"])(r.new_author_form[t].err),1)):Object(o["d"])("",!0)],2)})),128))],32)]})),_:1},8,["show-modal"])):Object(o["d"])("",!0)],64)})),St={name:"AuthorTool",components:{SearchBar:Q,Modal:lt,MaterialButton:A},props:{large:Boolean,toggleSearch:Boolean,toggleAdd:Boolean,toggleCount:Boolean,toggleDelete:Boolean,hideTitle:Boolean,bid:Number},data:function(){return{authors:[],new_author_form:{name:{order:1,label_name:"作者名",type:"text",value:"",err:""}},dropdownItems:[],show_modal_add:!1,submiting:!1,searchfocus:!1,inputfocus:!1,inputSearchAuthorName:""}},computed:{inputAuthorName:function(){return this.new_author_form.name.value}},watch:{inputAuthorName:function(t){var e=this;if(t.trim().length<=0)return this.inputfocus=!1,void(this.dropdownItems=[]);t.trim().length<=0||this.dropdownItems.filter((function(e){return t===e.name})).length>0||("number"===typeof this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=setTimeout((function(){fetch("/api/author/search/".concat(t.trim()),{method:"GET"}).then((function(t){return t.json()})).then((function(t){t.ok&&e.inputAuthorName.trim().length>0&&(e.dropdownItems=t.data)})).catch((function(t){console.log(t)}))}),1e3))},inputSearchAuthorName:function(t){var e=this;if(t.trim().length<=0)return this.searchfocus=!1,void(this.dropdownItems=[]);t.trim().length<=0||this.dropdownItems.filter((function(e){return t===e.name})).length>0||("number"===typeof this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=setTimeout((function(){fetch("/api/author/search/".concat(t.trim()),{method:"GET"}).then((function(t){return t.json()})).then((function(t){t.ok&&e.inputSearchAuthorName.trim().length>0&&(e.dropdownItems=t.data)})).catch((function(t){console.log(t)}))}),1e3))}},methods:{chooseAuthor:function(){var t=this.inputSearchAuthorName;this.dropdownItems.filter((function(e){return e.name===t.trim()})).length>0&&this.authors.filter((function(e){return e.name===t.trim()})).length<=0&&(this.authors.push(this.dropdownItems.filter((function(e){return e.name===t.trim()}))[0]),this.$emit("authors-changed",this.authors),this.inputSearchAuthorName="",this.dropdownItems=[],this.inputfocus=!1,this.searchfocus=!1)},unchooseAuthor:function(t){void 0===this.bid&&(this.authors=this.authors.filter((function(e){return e.aid!==t})),this.$emit("authors-changed",this.authors))},inputFocusout:function(){var t=this;setTimeout((function(){t.inputfocus=!1,t.searchfocus=!1}),200)},fetchAuthors:function(){var t=this;void 0!==this.bid&&fetch("/api/author/list/".concat(this.bid),{method:"GET"}).then((function(t){return t.json()})).then((function(e){e.ok&&(t.authors=e.data)})).catch((function(t){return console.log(t)}))},submitNewAuthor:function(t){var e=this;if(void 0===this.bid){var n=new FormData(t.target),o=this.new_author_form.name;o.value=o.value.trim(),o.value.length<=0?(o.valid=!1,o.err="作者名不可为空"):(o.valid=!0,o.err=""),o.valid&&(this.submiting=!0,fetch("/api/author/new",{method:"POST",body:n}).then((function(t){return t.json()})).then((function(t){t.ok||(o.valid=!1,o.err=t.msg),e.submiting=!1})).catch((function(t){console.log(t),o.valid=!1,o.err="网络错误",e.submiting=!1})))}else{var c=this.new_author_form.name;if(c.value=c.value.trim(),c.value.length<=0)c.valid=!1,c.err="作者名不可为空";else if(this.dropdownItems.filter((function(t){return t.name===c.value})).length<=0)c.valid=!1,c.err="作者不存在";else{this.submiting=!0;var r=this.dropdownItems.filter((function(t){return t.name===c.value}))[0];fetch("/api/author/add/".concat(r.aid,"/").concat(this.bid),{method:"POST"}).then((function(t){return t.json()})).then((function(t){t.ok?(e.authors.push(r),c.valid=!0,setTimeout((function(){e.show_modal_add=!1,delete c.valid,c.err="",c.value=""}),500)):(c.valid=!1,c.err=t.msg),e.submiting=!1})).catch((function(t){console.log(t),c.valid=!1,c.err="网络错误",e.submiting=!1}))}}},removeAuthor:function(t){var e=this;confirm("删除作者?")&&fetch("/api/author/del/".concat(t,"/").concat(this.bid||""),{method:"POST"}).then((function(t){return t.json()})).then((function(t){t.ok?e.authors=e.authors.filter((function(e){return e.aid!==t.data.aid})):alert(t.msg)})).catch((function(t){return console.log(t)}))}},created:function(){this.fetchAuthors()}};n("ad08");St.render=xt,St.__scopeId="data-v-6b6052fa";var Bt=St,Pt={name:"BookItem",components:{Card:S,MaterialButton:A,TagTool:dt,AuthorTool:Bt},props:{bookdata:Object,userclass:String},data:function(){return{show_modal:!1,cover:{src:this.bookdata.cover||"/cover.png",alt:"cover"},book_intro:this.bookdata.intro,book_props:{title:{label:"书名",val:this.bookdata.title||"title",type:"text",disabled:!0},isbn:{label:"ISBN",val:this.bookdata.isbn||"isbn",type:"text",disabled:!0},year:{label:"出版年",val:this.bookdata.year||0,type:"number",disabled:!0},page:{label:"页数",val:this.bookdata.page||0,type:"number",disabled:!0},rem:{label:"余量",val:this.bookdata.rem||0,type:"number",disabled:!0},total:{label:"总数",val:this.bookdata.total||0,type:"number",disabled:!0}}}},computed:{can_delete:function(){return"user"!==this.userclass&&"guest"!==this.userclass},can_borrow:function(){return"guest"!==this.userclass&&this.bookdata.rem>0}},methods:{borrowBook:function(){confirm("申请借阅 「".concat(this.bookdata.title,"」 ?"))&&fetch("/api/borrow/".concat(this.bookdata.bid),{method:"POST"}).then((function(t){return t.json()})).catch((function(t){return alert("Failed: "+JSON.stringify(t))}))},deleteBook:function(){var t=this;confirm("删除 「".concat(this.bookdata.title,"」"))&&fetch("/api/book/del/".concat(this.bookdata.bid),{method:"POST"}).then((function(t){return t.json()})).then((function(e){e.ok&&(t.$root.books=t.$root.books.filter((function(e){return e.bid!==t.bookdata.bid})))})).catch((function(t){return alert("Failed: "+JSON.stringify(t))}))},onBtnEditClicked:function(t,e){var n=this;if(!0===t.disabled)t.disabled=!1;else{t.disabled=!0;var o=this.$root.books.filter((function(t){return t.bid===n.bookdata.bid}))[0];if(t.val==o[e])return;var c=new FormData;c.append(e,t.val),fetch("/api/book/".concat(this.bookdata.bid,"/set"),{method:"POST",body:c}).then((function(t){return t.json()})).then((function(t){t.ok?(o[e]=t.data[e],n.book_props[e].val=t.data[e]):(n.book_props[e].val=o[e],console.log(t.msg))})).catch((function(t){return console.log(t)}))}}}};n("0520");Pt.render=_,Pt.__scopeId="data-v-ecd76d32";var It=Pt,$t=Object(o["u"])("data-v-565b85a8");Object(o["j"])("data-v-565b85a8");var At=Object(o["g"])("a",{class:"logo"},"BOOkMs",-1),Mt={key:0,class:"button-group"},Nt={key:1,class:"button-group"},Dt=Object(o["f"])(" 登出 "),Ut=Object(o["g"])("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[Object(o["g"])("path",{d:"M16 9v-4l8 7-8 7v-4h-8v-6h8zm-2 10v-.083c-1.178.685-2.542 1.083-4 1.083-4.411 0-8-3.589-8-8s3.589-8 8-8c1.458 0 2.822.398 4 1.083v-2.245c-1.226-.536-2.577-.838-4-.838-5.522 0-10 4.477-10 10s4.478 10 10 10c1.423 0 2.774-.302 4-.838v-2.162z"})],-1),Et=Object(o["g"])("button",{class:"toggle"},[Object(o["g"])("span",{class:"hamburger"})],-1),Ft={key:0,class:"check"},Lt={key:1,class:"cross"},zt={key:2},Rt={key:0,class:"check"},Gt={key:1,class:"cross"},Vt={key:2};Object(o["i"])();var Jt=$t((function(t,e,n,c,r,a){var s=Object(o["m"])("material-button"),i=Object(o["m"])("modal"),l=Object(o["m"])("modal-new-book"),u=Object(o["m"])("userprofile"),d=Object(o["m"])("borrow-table"),b=Object(o["m"])("pending-table"),h=Object(o["m"])("user-table");return Object(o["h"])(),Object(o["c"])(o["a"],null,[Object(o["g"])("nav",null,[At,"guest"===n.user.class?(Object(o["h"])(),Object(o["c"])("div",Mt,[Object(o["g"])("button",{class:"button",onClick:e[1]||(e[1]=function(t){return r.toggle_login_modal=!0})}," 登录 "),Object(o["g"])("button",{class:"button",onClick:e[2]||(e[2]=function(t){return r.toggle_register_modal=!0})}," 注册 ")])):(Object(o["h"])(),Object(o["c"])("div",Nt,[Object(o["g"])("button",{class:["button",{lgm:"admin"===n.user.class}],onClick:e[3]||(e[3]=function(t){return r.showUserprofile=!r.showUserprofile})},Object(o["n"])(n.user.name),3),Object(o["g"])("button",{class:"button",onClick:e[4]||(e[4]=function(t){return r.showBorrowTable=!r.showBorrowTable})}," 借阅📚 "),"admin"===n.user.class?(Object(o["h"])(),Object(o["c"])(o["a"],{key:0},[Object(o["g"])("button",{class:"button",onClick:e[5]||(e[5]=function(t){return r.showPendingTable=!r.showPendingTable})}," 审核⏳ "),Object(o["g"])("button",{class:"button",onClick:e[6]||(e[6]=function(t){return r.showUserTable=!0})}," 用户👥 "),Object(o["g"])("button",{class:"button",onClick:e[7]||(e[7]=function(t){return r.toggle_newbook_modal=!r.toggle_newbook_modal})}," 新书➕ ")],64)):Object(o["d"])("",!0),Object(o["g"])("button",{class:"button",onClick:e[8]||(e[8]=function(){return a.logout.apply(a,arguments)})},[Dt,Ut])])),Et]),"guest"===n.user.class?(Object(o["h"])(),Object(o["c"])(i,{key:0,class:"modal-login small",title:"登录","show-modal":r.toggle_login_modal,onClose:e[10]||(e[10]=function(t){return r.toggle_login_modal=!1})},{footer:$t((function(){return[Object(o["g"])(s,{type:"submit",form:"login-form",content:r.submiting?"登录中":"登录",disabled:r.submiting},null,8,["content","disabled"])]})),default:$t((function(){return[Object(o["g"])("form",{class:"form",id:"login-form",onSubmit:e[9]||(e[9]=Object(o["t"])((function(){return a.login.apply(a,arguments)}),["prevent"]))},[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(Object.keys(r.login_form).sort((function(t,e){return r.login_form[t].order-r.login_form[e].order})),(function(t){return Object(o["h"])(),Object(o["c"])("div",{class:["form-control",{success:!0===r.login_form[t].valid,error:!1===r.login_form[t].valid}],key:r.login_form[t].order},[Object(o["g"])("label",{for:t},Object(o["n"])(r.login_form[t].label_name),9,["for"]),Object(o["s"])(Object(o["g"])("input",{type:r.login_form[t].type,name:t,"onUpdate:modelValue":function(e){return r.login_form[t].value=e},autocomplete:"off"},null,8,["type","name","onUpdate:modelValue"]),[[o["o"],r.login_form[t].value]]),!0===r.login_form[t].valid?(Object(o["h"])(),Object(o["c"])("span",Ft,"✔️")):Object(o["d"])("",!0),!1===r.login_form[t].valid?(Object(o["h"])(),Object(o["c"])("span",Lt,"❌")):Object(o["d"])("",!0),!1===r.login_form[t].valid?(Object(o["h"])(),Object(o["c"])("small",zt,Object(o["n"])(r.login_form[t].err),1)):Object(o["d"])("",!0)],2)})),128))],32)]})),_:1},8,["show-modal"])):Object(o["d"])("",!0),"guest"===n.user.class?(Object(o["h"])(),Object(o["c"])(i,{key:1,class:"modal-register small",title:"注册","show-modal":r.toggle_register_modal,onClose:e[12]||(e[12]=function(t){return r.toggle_register_modal=!1})},{footer:$t((function(){return[Object(o["g"])(s,{type:"submit",form:"register-form",content:r.submiting?"注册中":"注册",disabled:r.submiting},null,8,["content","disabled"])]})),default:$t((function(){return[Object(o["g"])("form",{class:"form",id:"register-form",onSubmit:e[11]||(e[11]=Object(o["t"])((function(){return a.register.apply(a,arguments)}),["prevent"]))},[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(Object.keys(r.register_form).sort((function(t,e){return r.register_form[t].order-r.register_form[e].order})),(function(t){return Object(o["h"])(),Object(o["c"])("div",{class:["form-control",{success:!0===r.register_form[t].valid,error:!1===r.register_form[t].valid}],key:r.register_form[t].order},[Object(o["g"])("label",{for:t},Object(o["n"])(r.register_form[t].label_name),9,["for"]),Object(o["s"])(Object(o["g"])("input",{type:r.register_form[t].type,name:t,"onUpdate:modelValue":function(e){return r.register_form[t].value=e},autocomplete:"password"===t?"new-password":"off"},null,8,["type","name","onUpdate:modelValue","autocomplete"]),[[o["o"],r.register_form[t].value]]),!0===r.register_form[t].valid?(Object(o["h"])(),Object(o["c"])("span",Rt,"✔️")):Object(o["d"])("",!0),!1===r.register_form[t].valid?(Object(o["h"])(),Object(o["c"])("span",Gt,"❌")):Object(o["d"])("",!0),!1===r.register_form[t].valid?(Object(o["h"])(),Object(o["c"])("small",Vt,Object(o["n"])(r.register_form[t].err),1)):Object(o["d"])("",!0)],2)})),128))],32)]})),_:1},8,["show-modal"])):Object(o["d"])("",!0),Object(o["g"])(l,{"show-modal":r.toggle_newbook_modal,onClose:e[13]||(e[13]=function(t){return r.toggle_newbook_modal=!1})},null,8,["show-modal"]),r.showUserprofile?(Object(o["h"])(),Object(o["c"])(u,{key:2,show:r.showUserprofile,onClose:e[14]||(e[14]=function(t){return r.showUserprofile=!1})},null,8,["show"])):Object(o["d"])("",!0),r.showBorrowTable?(Object(o["h"])(),Object(o["c"])(d,{key:3,show:r.showBorrowTable,onClose:e[15]||(e[15]=function(t){return r.showBorrowTable=!1})},null,8,["show"])):Object(o["d"])("",!0),r.showPendingTable?(Object(o["h"])(),Object(o["c"])(b,{key:4,show:r.showPendingTable,onClose:e[16]||(e[16]=function(t){return r.showPendingTable=!1})},null,8,["show"])):Object(o["d"])("",!0),r.showUserTable?(Object(o["h"])(),Object(o["c"])(h,{key:5,show:r.showUserTable,onClose:e[17]||(e[17]=function(t){return r.showUserTable=!1})},null,8,["show"])):Object(o["d"])("",!0)],64)})),Xt=n("b85c"),Yt=Object(o["u"])("data-v-3ed589d2");Object(o["j"])("data-v-3ed589d2");var qt={key:0,class:"check status"},Kt={key:1,class:"cross status"},Ht={key:2},Zt={class:"form-control"},Wt=Object(o["g"])("label",{for:"intro"},"简介",-1),Qt=Object(o["g"])("textarea",{name:"intro",rows:"5",class:"input"},null,-1),te={key:0,class:"check status"},ee={key:1,class:"cross status"},ne={key:2},oe=Object(o["e"])('<div class="form-control" data-v-3ed589d2><label for="cover" data-v-3ed589d2>封面</label><div class="input-group input" data-v-3ed589d2><input name="cover" type="file" data-v-3ed589d2><div data-v-3ed589d2>或 </div><input type="text" name="cover_url" placeholder="图片URL" autocomplete="off" data-v-3ed589d2></div></div>',1),ce={class:"form-control"},re=Object(o["f"])("标签 "),ae=Object(o["g"])("path",{d:"M0 7.33l2.829-2.83 9.175 9.339 9.167-9.339 2.829 2.83-11.996 12.17z"},null,-1),se={class:"input"},ie={class:"form-control"},le=Object(o["g"])("label",null,"作者",-1),ue={class:"input"};Object(o["i"])();var de=Yt((function(t,e,n,c,r,a){var s=Object(o["m"])("tag-tool"),i=Object(o["m"])("collapse"),l=Object(o["m"])("author-tool"),u=Object(o["m"])("material-button"),d=Object(o["m"])("modal");return Object(o["h"])(),Object(o["c"])(d,{class:"large",title:"新书","show-modal":n.showModal},{footer:Yt((function(){return[Object(o["g"])(u,{content:"提交",onClick:a.submitNewBook,disabled:r.submiting},null,8,["onClick","disabled"])]})),default:Yt((function(){return[Object(o["g"])("form",{class:"form",onSubmit:e[3]||(e[3]=Object(o["t"])((function(){}),["prevent","stop"])),ref:"form"},[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(Object.keys(r.newbook_form).sort((function(t,e){return r.newbook_form[t].order-r.newbook_form[e].order})),(function(t){return Object(o["h"])(),Object(o["c"])("div",{class:["form-control",{success:!0===r.newbook_form[t].valid,error:!1===r.newbook_form[t].valid}],key:r.newbook_form[t].order},[Object(o["g"])("label",{for:t},Object(o["n"])(r.newbook_form[t].label_name),9,["for"]),Object(o["s"])(Object(o["g"])("input",{class:"input",type:r.newbook_form[t].type,name:t,"onUpdate:modelValue":function(e){return r.newbook_form[t].value=e},autocomplete:"off"},null,8,["type","name","onUpdate:modelValue"]),[[o["o"],r.newbook_form[t].value]]),!0===r.newbook_form[t].valid?(Object(o["h"])(),Object(o["c"])("span",qt,"✔️")):Object(o["d"])("",!0),!1===r.newbook_form[t].valid?(Object(o["h"])(),Object(o["c"])("span",Kt,"❌")):Object(o["d"])("",!0),!1===r.newbook_form[t].valid?(Object(o["h"])(),Object(o["c"])("small",Ht,Object(o["n"])(r.newbook_form[t].err),1)):Object(o["d"])("",!0)],2)})),128)),Object(o["g"])("div",Zt,[Wt,Qt,!0===r.intro.valid?(Object(o["h"])(),Object(o["c"])("span",te,"✔️")):Object(o["d"])("",!0),!1===r.intro.valid?(Object(o["h"])(),Object(o["c"])("span",ee,"❌")):Object(o["d"])("",!0),!1===r.intro.valid?(Object(o["h"])(),Object(o["c"])("small",ne,Object(o["n"])(r.intro.err),1)):Object(o["d"])("",!0)]),oe,Object(o["g"])("div",ce,[Object(o["g"])("label",null,[re,Object(o["g"])("span",{class:"expand-collapse",onClick:e[1]||(e[1]=function(t){return r.expandCollapseTags=!r.expandCollapseTags})},[(Object(o["h"])(),Object(o["c"])("svg",{xmlns:"http://www.w3.org/2000/svg",class:{expand:r.expandCollapseTags},viewBox:"0 0 24 24"},[ae],2))])]),Object(o["g"])(i,{"is-expand":r.expandCollapseTags},{default:Yt((function(){return[Object(o["g"])("div",se,[Object(o["g"])(s,{large:!0,"hide-title":!0,"toggle-search":!0,"toggle-add":!0})])]})),_:1},8,["is-expand"])]),Object(o["g"])("div",ie,[le,Object(o["g"])("div",ue,[Object(o["g"])(l,{large:!0,"hide-title":!0,"toggle-search":!0,"toggle-add":!0,"onAuthors-changed":e[2]||(e[2]=function(t){return r.authors=t})})])])],544)]})),_:1},8,["show-modal"])})),be=(n("aff5"),n("3835")),he=Object(o["u"])("data-v-32a43e68"),fe=he((function(t,e,n,c,r,a){return Object(o["h"])(),Object(o["c"])("div",{class:["collapse-container",{expand:a.expand}],ref:"cont"},[Object(o["l"])(t.$slots,"default")],2)})),ge={name:"Collapse",props:{isExpand:Boolean},computed:{expand:function(){return!0===this.isExpand?this.expandContent(this.$refs.cont):!1===this.isExpand&&this.collapseContent(this.$refs.cont),this.isExpand}},methods:{expandContent:function(t){if(void 0!==t){var e=t.scrollHeight;t.style.height=e+"px",t.addEventListener("transitionend",(function e(){t.removeEventListener("transitionend",e)}))}},collapseContent:function(t){if(void 0!==t){var e=t.scrollHeight,n=t.style.transition;t.style.transition="",requestAnimationFrame((function(){t.style.height=e+"px",t.style.transition=n,requestAnimationFrame((function(){t.style.height="0px"}))}))}}}};n("d3c3");ge.render=fe,ge.__scopeId="data-v-32a43e68";var me=ge,je={name:"NewBookForm",components:{Modal:lt,TagTool:dt,AuthorTool:Bt,Collapse:me,MaterialButton:A},props:{showModal:Boolean},data:function(){return{expandCollapseTags:!1,submiting:!1,authors:[],newbook_form:{title:{order:1,label_name:"书名",value:"",type:"text",err:""},pub:{order:2,label_name:"出版社",value:"",type:"text",err:""},isbn:{order:3,label_name:"ISBN",value:"",type:"text",err:""},year:{order:5,label_name:"出版年",value:"",type:"number",err:""},page:{order:4,label_name:"页数",value:"",type:"number",err:""},total:{order:6,label_name:"总数",value:"",type:"number",err:""}},intro:{label_name:"简介",value:"",err:""}}},methods:{submitNewBook:function(){var t,e=this,n=new FormData(this.$refs.form),o=!0,c=Object(Xt["a"])(n.entries());try{for(c.s();!(t=c.n()).done;){var r=Object(be["a"])(t.value,2),a=r[0],s=r[1];switch(a){case"title":var i=this.newbook_form[a];s.trim().length<=0?(i.valid=!1,i.err="书名不可为空",o=!1):i.valid=!0;break;case"pub":var l=this.newbook_form[a];s.trim().length<=0?(l.valid=!1,l.err="出版社名不可为空",o=!1):l.valid=!0;break;case"isbn":var u=this.newbook_form[a];/^(?=(?:\D*\d){10}(?:(?:\D*\d){3})?$)[\d-]+$/.test(s)?u.valid=!0:(u.valid=!1,u.err="ISBN 10 或 13",o=!1);break;case"year":var d=this.newbook_form[a],b=parseInt(s);b>=1e3&&b<=parseInt((new Date).getFullYear())?d.valid=!0:(d.valid=!1,d.err="这合适吗¿",o=!1);break;case"page":var h=this.newbook_form[a],f=parseInt(s);f>0&&f<Number.MAX_SAFE_INTEGER?h.valid=!0:(h.valid=!1,h.err="这合适吗¿",o=!1);break;case"total":var g=this.newbook_form[a],m=parseInt(s);m>=0&&m<Number.MAX_SAFE_INTEGER?g.valid=!0:(g.valid=!1,g.err="这合适吗¿",o=!1);break;case"intro":var j=this.intro;s.length<500?j.valid=!0:(j.valid=!1,j.err="简介不多于500字",o=!1);break;default:break}}}catch(p){c.e(p)}finally{c.f()}if(o){var O=this.$root.tags.filter((function(t){return!0===t.active})).map((function(t){return t.tid})),v=this.authors.map((function(t){return t.aid}));n.append("tags",JSON.stringify(O)),n.append("authors",JSON.stringify(v)),this.submiting=!0,fetch("/api/book/new",{method:"POST",body:n}).then((function(t){return t.json()})).then((function(t){if(t.ok){alert("成功");for(var n=0,o=Object.keys(e.newbook_form);n<o.length;n++){var c=o[n];delete e.newbook_form[c].valid,e.newbook_form[c].err="",e.newbook_form[c].value="",delete e.intro.valid,e.intro.value=""}e.submiting=!1}else alert("Failed : ".concat(JSON.stringify(t.err)))})).catch((function(t){console.log(t),alert("网络错误")}))}}}};n("cda8");je.render=de,je.__scopeId="data-v-3ed589d2";var Oe=je,ve=Object(o["u"])("data-v-275bd99a");Object(o["j"])("data-v-275bd99a");var pe={class:"container-userprofile"},we=Object(o["g"])("td",null,"UID",-1),ke=Object(o["g"])("td",null,"用户名",-1),_e=Object(o["g"])("td",null,"邮箱",-1),ye=Object(o["g"])("td",null,"借阅数",-1),Te=Object(o["g"])("td",null,"权限",-1);Object(o["i"])();var Ce=ve((function(t,e,n,c,r,a){var s=Object(o["m"])("modal");return Object(o["h"])(),Object(o["c"])(s,{"show-modal":n.show,class:"large",title:r.title},{default:ve((function(){return[Object(o["g"])("div",pe,[Object(o["g"])("table",null,[Object(o["g"])("tbody",null,[Object(o["g"])("tr",null,[we,Object(o["g"])("td",null,Object(o["n"])(r.user.uid),1)]),Object(o["g"])("tr",null,[ke,Object(o["g"])("td",null,Object(o["n"])(r.user.name),1)]),Object(o["g"])("tr",null,[_e,Object(o["g"])("td",null,Object(o["n"])(r.user.email),1)]),Object(o["g"])("tr",null,[ye,Object(o["g"])("td",null,Object(o["n"])(r.user.count),1)]),Object(o["g"])("tr",null,[Te,Object(o["g"])("td",null,Object(o["n"])(r.user.class),1)])])])])]})),_:1},8,["show-modal","title"])})),xe={name:"Userprofile",props:{show:Boolean},components:{Modal:lt},data:function(){return{user:{uid:233,name:"test",email:"233@233.233",count:"233",class:"test"},title:"Loading"}},created:function(){this.fetchData()},watch:{show:function(t){!0===t?this.fetchData():this.title="Loading"}},methods:{fetchData:function(){var t=this;fetch("/api/user",{method:"GET"}).then((function(t){return t.json()})).then((function(e){e.ok&&(t.user=e.data,t.title="".concat(e.data.name," 详细信息"))})).catch((function(t){return console.log(t)}))}}};n("215e");xe.render=Ce,xe.__scopeId="data-v-275bd99a";var Se=xe,Be=Object(o["u"])("data-v-6ab8f606");Object(o["j"])("data-v-6ab8f606");var Pe={class:"table-container"},Ie=Object(o["g"])("th",null,"#",-1),$e=Object(o["g"])("th",null,null,-1);Object(o["i"])();var Ae=Be((function(t,e,n,c,r,a){var s=Object(o["m"])("modal");return Object(o["h"])(),Object(o["c"])(s,{"show-modal":n.show,class:"auto",title:r.title},{default:Be((function(){return[Object(o["g"])("div",Pe,[Object(o["g"])("table",null,[Object(o["g"])("thead",null,[Object(o["g"])("tr",null,[Ie,Object(o["g"])("th",{onClick:e[1]||(e[1]=function(t){return a.sortTable("title")})},"书名"),Object(o["g"])("th",{onClick:e[2]||(e[2]=function(t){return a.sortTable("stime")})},"借书时间"),Object(o["g"])("th",{onClick:e[3]||(e[3]=function(t){return a.sortTable("ddl")})},"应还时间"),Object(o["g"])("th",{onClick:e[4]||(e[4]=function(t){return a.sortTable("status")})},"状态"),$e])]),Object(o["g"])("tbody",null,[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(r.rows,(function(t,e){return Object(o["h"])(),Object(o["c"])("tr",{key:e},[Object(o["g"])("td",null,Object(o["n"])(e),1),Object(o["g"])("td",null,Object(o["n"])(t.title),1),Object(o["g"])("td",null,Object(o["n"])(t.stime),1),Object(o["g"])("td",null,Object(o["n"])(t.ddl),1),Object(o["g"])("td",null,[Object(o["g"])("span",{class:["status",t.status]},Object(o["n"])(t.status),3)]),Object(o["g"])("td",null,["returned"!==t.status&&"pending_return"!==t.status?(Object(o["h"])(),Object(o["c"])("button",{key:0,class:"button",onClick:function(e){return a.returnBook(t.brid)}}," 还书 ",8,["onClick"])):Object(o["d"])("",!0)])])})),128))])])])]})),_:1},8,["show-modal","title"])})),Me={name:"BorrowTable",props:{show:Boolean},components:{Modal:lt},data:function(){return{rows:[],title:"Loading",ascending:!1,sortColumn:""}},watch:{show:function(t){!0===t?this.fetchData():this.title="Loading"}},created:function(){this.fetchData()},methods:{fetchData:function(){var t=this;fetch("/api/borrow/list",{method:"GET"}).then((function(t){return t.json()})).then((function(e){e.ok&&(t.rows=e.data,t.title="".concat(t.$root.user.name," 借阅信息"))})).catch((function(t){return console.log(t)}))},sortTable:function(t){this.sortColumn===t?this.ascending=!this.ascending:(this.ascending=!0,this.sortColumn=t);var e=this.ascending;this.rows.sort((function(n,o){return n[t]>o[t]?e?1:-1:n[t]<o[t]?e?-1:1:0}))},returnBook:function(t){var e=this;fetch("/api/return/".concat(t),{method:"POST"}).then((function(t){return t.json()})).then((function(n){n.ok&&(n.data.brid?e.rows.filter((function(e){return e.brid===t}))[0].status="pending_return":e.rows=e.rows.filter((function(e){return e.brid!==t})))})).catch((function(t){return console.log(t)}))}}};n("71b1");Me.render=Ae,Me.__scopeId="data-v-6ab8f606";var Ne=Me,De=Object(o["u"])("data-v-5e883b87");Object(o["j"])("data-v-5e883b87");var Ue={class:"table-container"},Ee=Object(o["g"])("th",null,"#",-1),Fe=Object(o["g"])("th",null,null,-1);Object(o["i"])();var Le=De((function(t,e,n,c,r,a){var s=Object(o["m"])("modal");return Object(o["h"])(),Object(o["c"])(s,{"show-modal":n.show,class:"auto",title:r.title},{default:De((function(){return[Object(o["g"])("div",Ue,[Object(o["g"])("table",null,[Object(o["g"])("thead",null,[Object(o["g"])("tr",null,[Ee,Object(o["g"])("th",{onClick:e[1]||(e[1]=function(t){return a.sortTable("username")})},"用户名"),Object(o["g"])("th",{onClick:e[2]||(e[2]=function(t){return a.sortTable("title")})},"书名"),Object(o["g"])("th",{onClick:e[3]||(e[3]=function(t){return a.sortTable("stime")})},"借书时间"),Object(o["g"])("th",{onClick:e[4]||(e[4]=function(t){return a.sortTable("ddl")})},"应还时间"),Object(o["g"])("th",{onClick:e[5]||(e[5]=function(t){return a.sortTable("status")})},"状态"),Fe])]),Object(o["g"])("tbody",null,[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(r.rows,(function(t,e){return Object(o["h"])(),Object(o["c"])("tr",{key:e},[Object(o["g"])("td",null,Object(o["n"])(e),1),Object(o["g"])("td",null,Object(o["n"])(t.username),1),Object(o["g"])("td",null,Object(o["n"])(t.title),1),Object(o["g"])("td",null,Object(o["n"])(t.stime),1),Object(o["g"])("td",null,Object(o["n"])(t.ddl),1),Object(o["g"])("td",null,[Object(o["g"])("span",{class:["status",t.status]},Object(o["n"])(t.status),3)]),Object(o["g"])("td",null,[Object(o["g"])("button",{class:"button",onClick:function(e){return a.acceptRequest(t.brid)}}," 同意 ",8,["onClick"]),Object(o["g"])("button",{class:"button",onClick:function(e){return a.rejectRequest(t.brid)}}," 拒绝 ",8,["onClick"])])])})),128))])])])]})),_:1},8,["show-modal","title"])})),ze={name:"PendingTable",props:{show:Boolean},components:{Modal:lt},data:function(){return{rows:[],title:"Loading",ascending:!1,sortColumn:""}},created:function(){this.fetchData()},watch:{show:function(t){!0===t?this.fetchData():this.title="Loading"}},methods:{fetchData:function(){var t=this;fetch("/api/borrow/pending/",{method:"GET"}).then((function(t){return t.json()})).then((function(e){e.ok&&(t.rows=e.data,t.title="待审核")})).catch((function(t){return console.log(t)}))},sortTable:function(t){this.sortColumn===t?this.ascending=!this.ascending:(this.ascending=!0,this.sortColumn=t);var e=this.ascending;this.rows.sort((function(n,o){return n[t]>o[t]?e?1:-1:n[t]<o[t]?e?-1:1:0}))},acceptRequest:function(t){var e=this;fetch("/api/borrow/accept/".concat(t),{method:"POST"}).then((function(t){return t.json()})).then((function(n){n.ok&&(e.rows=e.rows.filter((function(e){return e.brid!==t})))})).catch((function(t){return console.log(t)}))},rejectRequest:function(t){var e=this;fetch("/api/borrow/reject/".concat(t),{method:"POST"}).then((function(t){return t.json()})).then((function(n){n.ok&&(e.rows=e.rows.filter((function(e){return e.brid!==t})))})).catch((function(t){return console.log(t)}))}}};n("7c41");ze.render=Le,ze.__scopeId="data-v-5e883b87";var Re=ze,Ge=Object(o["u"])("data-v-5b3f7762");Object(o["j"])("data-v-5b3f7762");var Ve={class:"table-container"},Je={key:1};Object(o["i"])();var Xe=Ge((function(t,e,n,c,r,a){var s=Object(o["m"])("modal");return Object(o["h"])(),Object(o["c"])(s,{"show-modal":n.show,class:"auto",title:r.title},{default:Ge((function(){return[Object(o["g"])("div",Ve,[Object(o["g"])("table",null,[Object(o["g"])("thead",null,[Object(o["g"])("tr",null,[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(a.columns,(function(t,e){return Object(o["h"])(),Object(o["c"])("th",{key:e,onClick:function(e){return a.sortBy(t)},class:{active:r.sortKey==t}},[Object(o["f"])(Object(o["n"])(t)+" ",1),Object(o["g"])("span",{class:["arrow",r.sortOrders[t]>0?"asc":"dsc"]},null,2)],10,["onClick"])})),128))])]),Object(o["g"])("tbody",null,[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(a.filteredRows,(function(t,e){return Object(o["h"])(),Object(o["c"])("tr",{key:e},[(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(a.columns,(function(e,n){return Object(o["h"])(),Object(o["c"])("td",{key:n},["class"===e?(Object(o["h"])(),Object(o["c"])("span",{key:0,class:["class",t[e]],onClick:function(e){return a.setClass(t.uid)}},Object(o["n"])(t[e]),11,["onClick"])):(Object(o["h"])(),Object(o["c"])("span",Je,Object(o["n"])(t[e]),1))])})),128))])})),128))])])])]})),_:1},8,["show-modal","title"])})),Ye=(n("4160"),n("c975"),n("fb6a"),n("45fc"),n("159b"),{name:"UserTable",components:{Modal:lt},props:{show:Boolean},data:function(){return{rows:[],title:"Loading",sortKey:"uid",filterKey:"",sortOrders:{}}},computed:{columns:function(){return Object.keys(this.rows[0]||{})},filteredRows:function(){var t=this.sortKey,e=this.filterKey.trim(),n=this.sortOrders[t]||1,o=this.rows;return e.length>0&&(o=o.filter((function(t){return Object.keys(t).some((function(n){return String(t[n]).toLowerCase().indexOf(e)>-1}))}))),t&&(o=o.slice().sort((function(e,o){return e=e[t],o=o[t],(e===o?0:e>o?1:-1)*n}))),o}},watch:{show:function(t){!0===t?this.fetchData():this.title="Loading"}},created:function(){this.fetchData()},methods:{fetchData:function(){var t=this;fetch("/api/user/list",{method:"GET"}).then((function(t){return t.json()})).then((function(e){e.ok&&(t.rows=e.data,t.title="用户",t.columns.forEach((function(e){return t.sortOrders[e]=1})))})).catch((function(t){return console.log(t)}))},sortBy:function(t){this.sortKey=t,this.sortOrders[t]=-1*this.sortOrders[t]},setClass:function(t){var e=this,n=prompt("账号类型 in ('admin', 'user', 'banned')");fetch("/api/user/setclass/".concat(t,"/").concat(n),{method:"POST"}).then((function(t){return t.json()})).then((function(n){n.ok&&(e.rows.filter((function(e){return e.uid===t}))[0].class=n.data.class)})).catch((function(t){return alert("ERR: "+JSON.stringify(t))}))}}});n("417f");Ye.render=Xe,Ye.__scopeId="data-v-5b3f7762";var qe=Ye,Ke={name:"TopNavBar",components:{Modal:lt,MaterialButton:A,ModalNewBook:Oe,Userprofile:Se,BorrowTable:Ne,PendingTable:Re,UserTable:qe},props:{user:Object},emits:["login","logout"],data:function(){return{showUserprofile:!1,showBorrowTable:!1,showUserTable:!1,showPendingTable:!1,toggle_login_modal:!1,toggle_register_modal:!1,toggle_newbook_modal:!1,login_form:{username:{order:1,label_name:"用户名",type:"text",value:"",err:""},password:{order:2,label_name:"密码",type:"password",value:"",err:""}},register_form:{username:{order:1,label_name:"用户名",type:"text",value:"",err:""},email:{order:2,label_name:"邮箱",type:"email",value:"",err:""},password:{order:3,label_name:"密码",type:"password",value:"",err:""},password1:{order:4,label_name:"确认密码",type:"password",value:"",err:""}},submiting:!1}},methods:{login:function(t){var e=this,n=this.login_form.username,o=!0;n.value.trim().length<=0?(n.valid=!1,n.err="用户名为空",o=!1):(n.valid=!0,n.err="");var c=this.login_form.password;if(c.value.length<=0?(c.valid=!1,c.err="密码为空",o=!1):(c.valid=!0,c.err=""),o){var r=new FormData(t.target);fetch("/user/login",{method:"POST",body:r}).then((function(t){return t.json()})).then((function(t){t.ok?(e.$emit("login",t.data),e.toggle_login_modal=!1):e.login_form[t.err.key].err=t.err.msg})).catch((function(t){console.log(t)}))}},register:function(t){var e=this,n=this.register_form.username,o=this.register_form.email,c=this.register_form.password,r=this.register_form.password1,a=!0;if(n.value.trim().length<=0?(n.valid=!1,n.err="用户名为空",a=!1):(n.valid=!0,n.err=""),c.value.length<8?(c.valid=!1,c.err="密码至少8位",a=!1):(c.valid=!0,c.err=""),r.value!==c.value?(r.valid=!1,r.err="密码不匹配",a=!1):(r.valid=!0,r.err=""),/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(o.value)?(o.valid=!0,o.err=""):(o.valid=!1,o.err="邮箱不合法",a=!1),a){var s=new FormData(t.target);fetch("/user/register",{method:"POST",body:s}).then((function(t){return t.json()})).then((function(t){if(t.ok)e.$emit("register",t.data),e.toggle_register_modal=!1;else if(t.err){var n,o=Object(Xt["a"])(t.err);try{for(o.s();!(n=o.n()).done;){var c=n.value;e.register_form[c.param].valid=!1,e.register_form[c.param].err=c.msg}}catch(r){o.e(r)}finally{o.f()}}else console.log(t)})).catch((function(t){console.log(t)}))}},logout:function(t){var e=this;t.target.disabled=!0,fetch("/user/logout",{method:"POST"}).then((function(t){return t.json()})).then((function(n){n.ok&&e.$emit("logout"),t.target.disabled=!1})).catch((function(e){console.log(e),t.target.disabled=!1}))}}};n("517f");Ke.render=Jt,Ke.__scopeId="data-v-565b85a8";var He=Ke,Ze=Object(o["u"])("data-v-65baf182");Object(o["j"])("data-v-65baf182");var We={class:"search-input-wrapper"},Qe=Object(o["g"])("label",{class:"search-label",for:"stext"},"搜索",-1),tn=Object(o["g"])("span",{class:"spliter"},null,-1),en=Object(o["g"])("button",{type:"submit",class:"btn-go"},[Object(o["g"])("svg",{focusable:"false",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"svg-search"},[Object(o["g"])("path",{d:"M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})])],-1),nn=Object(o["g"])("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round",class:"svg-down-arrow"},[Object(o["g"])("polyline",{points:"6 9 12 15 18 9"})],-1);Object(o["i"])();var on=Ze((function(t,e,n,c,r,a){var s=Object(o["m"])("collapse");return Object(o["h"])(),Object(o["c"])("form",{class:"search-form",onSubmit:e[3]||(e[3]=Object(o["t"])((function(e){return t.$emit("submit-search",r.searchText)}),["stop","prevent"]))},[Object(o["g"])("div",We,[Qe,Object(o["s"])(Object(o["g"])("input",{class:"search-input",type:"search",placeholder:"书名/ISBN",name:"stext","onUpdate:modelValue":e[1]||(e[1]=function(t){return r.searchText=t}),autocomplete:"off"},null,512),[[o["p"],r.searchText]]),tn,en,Object(o["g"])("button",{type:"button",class:["btn-expand",{expand:r.filter_expend}],onClick:e[2]||(e[2]=function(t){return r.filter_expend=!r.filter_expend})},[nn],2),Object(o["g"])(s,{class:"filter-collapse","is-expand":r.filter_expend},{default:Ze((function(){return[Object(o["l"])(t.$slots,"default")]})),_:3},8,["is-expand"])])],32)})),cn={name:"Searchbar",components:{Collapse:me},data:function(){return{filter_expend:!1,searchText:""}},mounted:function(){}};n("ac78");cn.render=on,cn.__scopeId="data-v-65baf182";var rn=cn,an=Object(o["u"])("data-v-3305e01f");Object(o["j"])("data-v-3305e01f");var sn={class:"page"},ln=Object(o["g"])("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[Object(o["g"])("path",{d:"M16.67 0l2.83 2.829-9.339 9.175 9.339 9.167-2.83 2.829-12.17-11.996z"})],-1),un={key:1,class:"page__dots"},dn={key:2,class:"page__dots"},bn=Object(o["g"])("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[Object(o["g"])("path",{d:"M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"})],-1);Object(o["i"])();var hn=an((function(t,e,n,c,r,a){return Object(o["h"])(),Object(o["c"])("ul",sn,[Object(o["g"])("li",{class:["page__btn",{active:1!=r.currentPage}],onClick:e[1]||(e[1]=function(t){return r.currentPage--})},[ln],2),r.currentPage>3&&n.total>7?(Object(o["h"])(),Object(o["c"])("li",{key:0,class:"page__numbers",onClick:e[2]||(e[2]=function(t){return r.currentPage=1})}," 1 ")):Object(o["d"])("",!0),n.total>7&&r.currentPage>3?(Object(o["h"])(),Object(o["c"])("li",un,"...")):Object(o["d"])("",!0),(Object(o["h"])(!0),Object(o["c"])(o["a"],null,Object(o["k"])(a.displayedPages,(function(t,e){return Object(o["h"])(),Object(o["c"])("li",{class:["page__numbers",{active:r.currentPage===t}],key:e,onClick:function(e){return r.currentPage=t}},Object(o["n"])(t),11,["onClick"])})),128)),r.currentPage<n.total-2&&n.total>7?(Object(o["h"])(),Object(o["c"])("li",dn," ... ")):Object(o["d"])("",!0),r.currentPage<n.total-2&&n.total>7?(Object(o["h"])(),Object(o["c"])("li",{key:3,class:"page__numbers",onClick:e[3]||(e[3]=function(t){return r.currentPage=n.total})},Object(o["n"])(n.total),1)):Object(o["d"])("",!0),Object(o["g"])("li",{class:["page__btn",{active:r.currentPage<n.total}],onClick:e[4]||(e[4]=function(t){return r.currentPage++})},[bn],2)])})),fn=(n("a630"),{name:"Pagination",props:{total:Number},data:function(){return{currentPage:1}},methods:{},computed:{displayedPages:function(){var t=this;return this.total<=7?Array.from({length:this.total},(function(t,e){return e+1})):this.currentPage<=3?Array.from({length:5},(function(t,e){return e+1})):this.currentPage<this.total-2?Array.from({length:3},(function(e,n){return t.currentPage+n-1})):Array.from({length:5},(function(e,n){return t.total-4+n}))}},watch:{currentPage:function(){this.$emit("page-updated",this.currentPage)}}});n("39e2");fn.render=hn,fn.__scopeId="data-v-3305e01f";var gn=fn,mn={name:"App",components:{BookItem:It,TopBar:He,SearchBar:rn,TagTool:dt,AuthorTool:Bt,Pagination:gn},data:function(){return{fallback:"loading",user:{class:"guest"},books:[],tags:[{tid:1,name:"我列开来1",bcount:233}],authors:[],totalPages:1,currentPage:1,searchText:"",filter_expanded:!1}},created:function(){this.checkLogin(),this.fetchData()},methods:{fetchData:function(){var t=this;this.fallback="Loading",fetch("/api/book/list",{method:"GET"}).then((function(t){return t.json()})).then((function(e){e.ok?(t.books=e.data.books,t.totalPages=e.data.count,t.fallback=""):(alert("failed"),console.log(e))})).catch((function(e){console.log(e),t.fallback=JSON.stringify(e)})),fetch("/api/tag/list",{method:"GET"}).then((function(t){return t.json()})).then((function(e){e.ok?t.tags=e.data:(alert("failed"),console.log(e))})).catch((function(t){return console.log(t)}))},checkLogin:function(){var t=this;fetch("/user/login",{method:"POST"}).then((function(t){return t.json()})).then((function(e){e.ok&&(t.user=e.data)})).catch((function(t){return console.log(t)}))},search:function(t){var e=this;t?this.searchText=t:t=this.searchText;var n=new URL("/api/book/list",window.location.origin),o={authors:JSON.stringify(this.authors.map((function(t){return t.aid}))),tags:JSON.stringify(this.tags.filter((function(t){return t.active})).map((function(t){return t.tid}))),s_text:t,pno:this.currentPage};n.search=new URLSearchParams(o),this.fallback="Loading",fetch(n,{method:"GET"}).then((function(t){return t.json()})).then((function(t){t.ok?(e.books=t.data.books,e.totalPages=parseInt(t.data.count),console.log(e.totalPages),e.fallback=""):(alert("failed"),console.log(t))})).catch((function(t){console.log(t),e.fallback=JSON.stringify(t)}))}},watch:{currentPage:function(){this.search()}}};n("64be");mn.render=a;var jn=mn;Object(o["b"])(jn).mount("#app")},"64be":function(t,e,n){"use strict";n("c894")},"6a92":function(t,e,n){},"71a2":function(t,e,n){},"71b1":function(t,e,n){"use strict";n("e61d")},"7c41":function(t,e,n){"use strict";n("41eb")},"891d":function(t,e,n){},"8d46":function(t,e,n){},"8d6d":function(t,e,n){},"8dcf":function(t,e,n){"use strict";n("37fb")},9202:function(t,e,n){},ac78:function(t,e,n){"use strict";n("1870")},ad08:function(t,e,n){"use strict";n("2f88")},af27:function(t,e,n){"use strict";n("bced")},bced:function(t,e,n){},c894:function(t,e,n){},c932:function(t,e,n){},cda8:function(t,e,n){"use strict";n("2f4c")},d3c3:function(t,e,n){"use strict";n("8d6d")},e2a2:function(t,e,n){"use strict";n("891d")},e61d:function(t,e,n){}});
//# sourceMappingURL=app.dbb8e2d6.js.map